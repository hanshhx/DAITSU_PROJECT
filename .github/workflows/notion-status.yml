name: Project Status Dashboard

on:
  push:
    branches: [ main ]

jobs:
  build-and-report:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Docker Build
        run: |
          echo "í”„ë¡œì íŠ¸ ë¹Œë“œ í…ŒìŠ¤íŠ¸ ì‹œì‘..."
          # [ìˆ˜ì •] docker-compose (êµ¬ë²„ì „) -> docker compose (ì‹ ë²„ì „)ìœ¼ë¡œ ë³€ê²½
          docker compose build

      - name: Update Notion Success
        if: success()
        run: |
          curl -X PATCH "https://api.notion.com/v1/pages/${{ secrets.NOTION_PAGE_ID }}" \
            -H "Authorization: Bearer ${{ secrets.NOTION_TOKEN }}" \
            -H "Content-Type: application/json" \
            -H "Notion-Version: 2022-06-28" \
            --data '{
              "properties": {
                "Status": { "select": { "name": "ğŸŸ¢ ë¹Œë“œ ì„±ê³µ (ì •ìƒ)" } },
                "Description": { "rich_text": [ { "text": { "content": "ìµœê·¼ ì»¤ë°‹: ${{ github.event.head_commit.message }}" } } ] }
              }
            }'

      - name: Update Notion Failure
        if: failure()
        run: |
          curl -X PATCH "https://api.notion.com/v1/pages/${{ secrets.NOTION_PAGE_ID }}" \
            -H "Authorization: Bearer ${{ secrets.NOTION_TOKEN }}" \
            -H "Content-Type: application/json" \
            -H "Notion-Version: 2022-06-28" \
            --data '{
              "properties": {
                "Status": { "select": { "name": "ğŸ”´ ë¹Œë“œ ì‹¤íŒ¨ (ì ê²€)" } },
                "Description": { "rich_text": [ { "text": { "content": "ì—ëŸ¬ ë°œìƒ ì§€ì : ${{ github.sha }} / ê°œë°œì í™•ì¸ ìš”ë§" } } ] }
              }
            }'